<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta content="width=device-width,initial-scale=1.0" name="viewport">
    <meta content="(C) 2012 Mark Constable (AGPLv3)" name="author">
<!--    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300' rel='stylesheet' type='text/css'> -->
    <title id="title">Markup</title>
    <style>

/* layout, start with resetus maximus */

* {
  border: none;
/*  font-family: "Open Sans Condensed", sans-serif; */
  font-family: sans-serif;
  font-size: 100%;
  line-height: 160%;
  margin: 0em;
  outline: none;
  padding: 0em;
/*
  -webkit-transition: all 0.5s ease-in-out;
  -moz-transition: all 0.5s ease-in-out;
  -ms-transition: all 0.5s ease-in-out;
  -o-transition: all 0.5s ease-in-out;
  transition: all 0.5s ease-in-out;
*/
}

html {
  height: 100%;
  width: 100%;
}

body {
  margin: 2.6em auto;
  overflow-y: scroll;
  width: 54em;
}

h1 { font-size: 160%; }
h2 { font-size: 130%; }
h3 { font-size: 110%; }
h4 { font-size: 100%; }
h5 { font-size: 90%; }
h6 { font-size: 75%; }

h2, h3, h4, h5, h6 {
  margin-top: 1em;
}

h1 {
  line-height: 100%;
}

h2 {
  border-bottom-style: solid;
  border-bottom-width: 0.05em;
}

p, hr, ul, ol, blockquote, pre, #area {
  margin: 0.5em 0em 1em 0em;
}

ul, ol, blockquote {
  margin-left: 1.5em;
}

blockquote p {
  font-family: "Georgia", serif;
  font-style: italic;
}

code, tt {
  border-style: solid;
  border-radius: 0.3em;
  border-width: 0.075em;
  font-family: monospace;
  margin: 0 0.1em;
  padding: 0 0.3em;
}

a {
  text-decoration: none;
}

pre, #area {
  border-radius: 0.3em;
  border-style: solid;
  border-width: 0.075em;
  font-family: monospace;
  overflow: auto;
  padding: 0.5em 1em;
}

pre > code {
  border: none;
  margin: 0em;
  padding: 0em;
}

hr {
  border-bottom-style: solid;
  border-bottom-width: 0.075em;
}

nav {
  margin: 0.675em 0em;
  text-align: center;
}

nav a {
  border-style: solid;
  border-width: 0.09em;
  border-radius: 0.3em;
  font-size: 75%;
  padding: 0.5em 1em;
}

footer {
  text-align: center;
}

footer a {
  font-family: "Georgia", serif;
  font-size: 75%;
  font-style: italic;
}

#top {
  height: 3.3em;
  left: 0;
  position: fixed;
  top: 0;
  width: 100%;
  z-index: 99;
}

#top nav {
  text-align: right;
  padding-right: 0.5em;
}

#logo {
  display: inline-block;
  float: left;
  line-height: 100%;
}

#logo img {
  height: 3em;
  vertical-align: top;
}

#logo span {
  font-size: 2.7em;
  font-weight: bold;
  line-height: 100%;
}

#mid {
  min-height: 16em;
  border-style: solid;
  border-width: 0.075em;
  border-radius: 0.6em;
  padding: 1em 1.5em;
  margin-bottom: 1em;
}

#text {
  font-family: monospace;
  height: 10em;
  margin-top: 0.5em;
  width: 100%;
}

.hidden { display: none; }



a.thumbnail {
  display: block;
  text-align: center;
}

a.tree + div {
  display: none;
  visibility: hidden;
  opacity: 0;
  height: 0em;
}

a.tree.open + div {
  display: block;
  visibility: visible;
  opacity: 1;
  height: auto;
}

a.tree {
  display: block;
  position: relative;
  border-bottom-style: solid;
  border-bottom-width: 0.075em;
  font-weight: bold;
  letter-spacing: 0.1em;
  padding-left: 1.5em;
}

a.tree::before {
  background: no-repeat left center url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iCiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiCiB2aWV3Qm94PSIwIDAgMTYgMTYiCiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJ4TWluWU1pbiBtZWV0IgogaWQ9ImRvd25zdmciPgo8cG9seWdvbiBwb2ludHM9IjcsNSA3LDExIDEwLDgiCiBzdHlsZT0iZmlsbDojN0Y3RjdGOyBzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MC41Ii8+Cjwvc3ZnPgo=);
  content: "";
  position: absolute;
  left: 0; top: 0;
  width: 1.5em; height: 1.5em;

  -webkit-transform: rotate(0deg);
  -moz-transform: rotate(0deg);
  transform: rotate(0deg);

  -webkit-transition: all 0.3s ease-in-out;
  -moz-transition: all 0.3s ease-in-out;
  transition: all 0.3s ease-in-out;
}

a.tree.open::before {
  content: "";
  width: 1.5em; height: 1.5em;

  -webkit-transform: rotate(90deg);
  -moz-transform: rotate(90deg);
  transform: rotate(90deg);
}

#view div a.tree { margin-left: 1em; }
#view div div a.tree { margin-left: 2em; }
#view div div div a.tree { margin-left: 3em; }
#view div div div div a.tree { margin-left: 4em; }
#view div div div div div a.tree { margin-left: 5em; }
#view div div div div div div a.tree { margin-left: 6em; }
#view div div div div div div div a.tree { margin-left: 7em; }

/* colors */

body {
  background-color: #DFDFDF;
  color: #2F2F2F;
}

h2 {
  border-bottom-color: #CFCFCF;
}

blockquote p {
  color: #5F5F5F;
}

code, tt {
  border-color: #EBEBEB;
  background-color: #F7F7F7;
}

a {
  color: #007FFF;
}

a:hover {
  color: #DF0000;
}

#text {
  background-color: #F7F7F7;
  color: #3F3F3F;
}

pre, #area {
  background-color: #F7F7F7;
  border-radius: 0.3em;
  border-color: #CFCFCF;
  color: #2F2F2F;
  box-shadow: 0 0.2em 0.5em rgba(0, 0, 0, 0.5);
}

pre:hover, #area:hover {
  box-shadow: 0.5em 0.5em 0.5em rgba(0, 0, 0, 0.5);
}

hr {
  border-bottom-color: #CFCFCF;
}

nav a {
  background-color: #DFDFDF;
  border-color: #CFCFCF;
  border-bottom-color: #BFBFBF;
  color: #1F1F1F;
  text-shadow: 0 0.075em 0 #FFFFFF;
  background: -moz-linear-gradient(top, #5F5F5F, #1F1F1F);
  background: -webkit-linear-gradient(top, #5F5F5F, #1F1F1F);
  background: linear-gradient(top, #5F5F5F, #1F1F1F);
  box-shadow: 0 0.09em 0.09em #FFFFFF inset;
}

nav a:hover {
  background: #CFCFCF;
}

nav a:active {
  background: #3F7FCF;
  box-shadow: inset 0 0.2em 0.5em rgba(0, 0, 0, 1);
}

footer a {
  color: #7F7F7F;
}

#top {
  background-color: #3F3F3F;
  background: -moz-linear-gradient(top, #5F5F5F, #1F1F1F);
  background: -webkit-linear-gradient(top, #5F5F5F, #1F1F1F);
  background: linear-gradient(top, #5F5F5F, #1F1F1F);
  box-shadow: 0 0 1em rgba(0, 0, 0, 1);
}

#top nav a {
  background-color: #4F4F4F;
  color: #DFDFDF;
  border-color: #3F3F3F;
  text-shadow: 0 -0.09em 0 #000000;
  background: linear-gradient(top, #5F5F5F, #1F1F1F);
  box-shadow: 0 0.09em 0.09em #7F7F7F inset;
}

#top nav a:hover {
  background: #2F2F2F;
}

#top nav a:active {
  background: #3F3F3F;
  box-shadow: inset 0 0.2em 0.5em rgba(0, 0, 0, 1);
}

#logo span {
  color: #7F7F7F;
  text-shadow: 0 -0.025em 0.025em #BFBFBF, 0 0.025em 0.025em #000000;
}

#mid {
  background-color: #FFFFFF;
  border-color: #CFCFCF;
  box-shadow: 0 0.2em 0.5em rgba(0, 0, 0, 0.5);
}

#top nav a.current, nav a.current {
  color: #EF0000;
}

#top nav#editor_menu, #top nav#states_menu {
  text-align: center;
  clear: both;
  position: absolute;
  width: 8em;
  top: 2.5em;
  right: 0em;
  z-index: 99;
}

#top nav#editor_menu a, #top nav#states_menu a {
  background-color: #2F2F2F;
  margin: 0.25em 0;
  display: block;
}

img.sml {
  float: right;
  border: 0.25em solid #7F7F7F;
  border-radius: 0.25em;
  margin-left: 0.5em;
  box-shadow: 0 0.2em 0.5em rgba(0, 0, 0, 0.75);
}

/* tree color */

a.tree {
  border-bottom-color: transparent;
  text-shadow: #000000 0em 0.05em 0.05em;
}

a.tree:hover {
  background-color: #F7F7F7;
  color: #EF0000;
}

a.tree.open {
  border-bottom-color: #E7E7E7;
}
/*
.btn-custom {
  background-color: hsl(70, 11%, 23%) !important;
  background-repeat: repeat-x;
  filter: progid:DXImageTransform.Microsoft.gradient(startColorstr="#7b7f66", endColorstr="#3e4134");
  background-image: -khtml-gradient(linear, left top, left bottom, from(#7b7f66), to(#3e4134));
  background-image: -moz-linear-gradient(top, #7b7f66, #3e4134);
  background-image: -ms-linear-gradient(top, #7b7f66, #3e4134);
  background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #7b7f66), color-stop(100%, #3e4134));
  background-image: -webkit-linear-gradient(top, #7b7f66, #3e4134);
  background-image: -o-linear-gradient(top, #7b7f66, #3e4134);
  background-image: linear-gradient(#7b7f66, #3e4134);
  border-color: #3e4134 #3e4134 hsl(70, 11%, 17.5%);
  color: #fff !important;
  text-shadow: 0 -1px 0 rgba(0, 0, 0, 0.36);
  -webkit-font-smoothing: antialiased;
}
*/
</style>
    <script>

window.onload = function() {

  // globals

  var uri = '', current_uri = '';

  // support functions

  var id = function(id) { return document.getElementById(id); };

  var html_encode = function(str) {
    return str.replace(/[&<>"']/g, function($0) {
      return "&" + {"&":"amp", "<":"lt", ">":"gt", '"':"quot", "'":"#39"}[$0] + ";";
    });
  };

  var htm = function(str, target) {
//    id('text').value = str;
    var json = /\s*<!--\s*([\s\S]*?)\s*-->\s*/mgi.exec(str);
    if (json instanceof Array && typeof json[1] === 'string') {
console.log('json='+json[1])
      var text = /<!--[\s\S]*-->\s*([\s\S]*)\s*$/mgi.exec(str);
      if (text instanceof Array && typeof text[1] === 'string') {
console.log('text='+text[1])
//        id('text').value = json[1] + text[1];
//        id('text').value = str;
        if (id(target)) id(target).innerHTML = marked(text[1]);
      }
      var o = JSON.parse(json[1]);
      Object.keys(o).forEach(function(k) {
        if (k === 'script') {
          eval(o[k]);
        } else if (k === 'prepend') {
console.log("prepend="+target)
          var tmp = id(target).innerHTML;
          tmp = o[k] + tmp;
          id(target).innerHTML = tmp;
        } else if (k === 'append') {
console.log("append="+target)
          var tmp = id(target).innerHTML;
          tmp += o[k];
          id(target).innerHTML = tmp;
        } else if (k === 'alert') {
          alert(o[k]);
        } else {
//console.log("id(k)="+id(k))
          if (id(k)) id(k).innerHTML = o[k];
        }
      });
    } else {
//      id('text').value = str;
      if (id(target)) id(target).innerHTML = marked(str);
    }
  }

  window.onpopstate = function(e) {
    if (e.state !== null) {
      var state = e.state || {};
      if ('id' in state) {
        get(location, state.id, function() {
          var el = id(state.id);
          if (el.previousElementSibling.nodeName === 'A'
           && el.previousElementSibling.classList.contains('tree')) {
            if (el.previousElementSibling.classList.contains('open'))
              el.previousElementSibling.classList.remove('open');
            else
              el.previousElementSibling.classList.add('open');
          }
        });
      }
    }
  }

  var get = function(url, target, callback) {
    url = url || location;
    target = target || 'view';
console.log("get("+url+", "+target+", "+callback+")")
    if (url.hostname != location.hostname) {
      location = url;
      return false;
    }
    var newpath = '',
        urlpath = url.pathname;

    current_uri = urlpath;
    document.title = urlpath;
    history.pushState({id:target}, '', urlpath);
    
    if (urlpath.match(/^\/\d+$/)) {
      newpath = ['/lib/htm', urlpath, '.htm'].join('').replace(/\/\//g, '/');
    } else if (urlpath.match(/^\/.+$/)) {
      newpath = ['/lib/md', urlpath, '.md'].join('').replace(/\/\//g, '/');
    } else {
      newpath = 'README.md';
    }
    var cached = localStorage.getItem(urlpath);
    if (cached) {
      htm(cached, target);
      if (typeof callback === 'function') callback(target);
      return false;
    } else {
      var xhr = new XMLHttpRequest() || new window.ActiveXObject('Microsoft.XMLHTTP');
      xhr.onreadystatechange = function() {
        if (xhr.readyState == 4 && xhr.status == 200) {
          localStorage.setItem(urlpath, xhr.responseText);
          htm(xhr.responseText, target);
          if (typeof callback === 'function') callback(target);
          return false;
        }
      }
      xhr.open('GET', newpath, true); xhr.send();
    }
  }

  id('nav').onclick = function(e) {
console.log("NAV="+e.target)
    if (e.target.pathname == '/clear')
      localStorage.clear();
    else
      get(e.target);
    return false;
  };

  id('view').onclick = function(e) {
    var t = e.target;
    if (t.classList.contains('tree')) {
console.log("t.classList.contains(tree)")
      var i = t.pathname.replace(/(\/|\.|-)/g, '_').toLowerCase();
      if (t.classList.contains('cached')) {
        t.classList.toggle('open');
      } else {
//alert("t="+t+", i="+i)
        get(t, i, function() {
          t.classList.toggle('open');
          t.classList.add('cached');
          return false;
        })
      }
      return false;
    }
console.log("view.onclick fallthrough")
  };

  get();

};
    </script>
<!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->
  </head>
  <body>
    <header id="top">
      <a id="logo" href="/">
        <img id="logo_img" alt="ALSA LOGO" src="/lib/svg/lookright3.svg">
        <span id="logo_txt">alsa.opensrc.org</span>
      </a>
      <nav id="nav">
        <a href="/0">HOME</a>
        <a href="/">README</a>
        <a href="https://github.com/markc/markup">SOURCE</a>
        <a href="/clear">FLUSH</a>
      </nav>
    </header>
    <section id="mid">
      <div id="area" class="hidden">
        <textarea id="text"></textarea>
      </div>
      <aside id="sidebar"></aside>
      <div id="view"></div>
    </section>
    <footer id="end">
      <a href="http://validator.w3.org/check?uri=referer" title="Validate This Page">
        Copyright &copy; 2007-2012 Mark Constable (AGPLv3)
      </a>
    </footer>
    <!-- <script src="https://raw.github.com/chjj/marked/master/lib/marked.js"></script> -->
    <script src="/lib/js/marked.js"></script>
  </body>
</html>
